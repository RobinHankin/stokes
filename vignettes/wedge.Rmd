---
title: "Exterior calculus with R"
author: "Robin K. S. Hankin"
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{The exterior calculus}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# The exterior calculus

Ordinary differential calculus may be generalized to
arbitrary-dimensional oriented manifolds using the exterior calculus.
Here I show how the wedge package furnishes functionality for working
with the exterior calculus, and provide numerical verification of a
number of theorems.

Notation follows that of Spivak, and Hubbard and Hubbard.

```{r,echo=FALSE,print=FALSE,results='hide'}
require("wedge",quietly=TRUE,warn.conflicts=FALSE)
```

Recall that a $k$-tensor is a multilinear map $S\colon
V^k\longrightarrow\mathbb{R}$, where $V=\mathbb{R}^n$ is considered as
a vector space; Spivak denotes the space of multilinear maps as
$\mathcal{J}^k(V)$.  Formally, multilinearity means

\[
S\left(v_1,\ldots,av_i,\ldots,v_k\right)=a\cdot S\left(v_1,\ldots,v_i,\ldots,v_k\right)
\]

and

\[S\left(v_1,\ldots,v_i+{v_i}',\ldots,v_k\right)=S\left(v_1,\ldots,v_i,\ldots,x_v\right)+
S\left(v_1,\ldots,{v_i}',\ldots,v_k\right).
\]

If $S\in\mathcal{J}^k(V)$ and $T\in\mathcal{J}^l(V)$, then we may
define $S\otimes T\in\mathcal{J}^{k+l}(V)$ as

\[
S\otimes T\left(v_1,\ldots,v_k,v_{k+1},\ldots,v_{k+l}\right)=
S\left(v_1,\ldots,v_k\right)\cdot
T\left(v_1,\ldots,v_l\right)
\]


Spivak observes that $\mathcal{J}^k(V)$ is spanned by the $n^k$
products of the form

\[
\phi_{i_1}\otimes\phi_{i_2}\otimes\ldots\otimes\phi_{i_k}\qquad
1\leq i_i,i_2,\ldots,i_k\leq n
\]

where $v_1,\ldots,v_k$ is a basis for $V$ and
$\phi_i\left(v_j\right)=\delta_{ij}$; we can therefore write

\[
S=\sum_{1\leq i_1,\ldots,i_k\leq n} a_{i_1\ldots i_k} 
\phi_{i_1}\otimes\ldots\otimes\phi_{i_k}.
\]

The space spanned by such products has a natural representation in R
as an array of dimensions $n\times\cdots\times n$.  If ```A``` is such
an array, then the element ```A[i_1,i_2,...,i_k]``` is the coefficient
of $\phi_{i_1}\otimes\ldots\otimes\phi_{i_k}$.  However, it is more
efficient and conceptually cleaner to consider a *sparse* array.
Considering the case $n=5,k=4$

We can test these identities in R using the idiom furnished by the
wedge package:

```{r}
k <- 4
n <- 5
M <- matrix(c(5,1,1,1, 1,1,2,3, 1,3,4,2),3,4,byrow=TRUE)
M
S <- as.ktensor(M,coeffs= 0.5 + 1:3)
S
```

So $S$ is a 4-tensor, mapping $V^4$ to $\mathbb{R}$, where
$V=\mathbb{R}^5$.  Here we have
$S=1.5\phi_5\otimes\phi_1\otimes\phi_1\otimes\phi_1+2.5\phi_1\otimes\phi_1\otimes\phi_2\otimes\phi_3+3.5\phi_1\otimes\phi_3\otimes\phi_4\otimes\phi_2$.
Note that on some implementations the row order of object ```S``` will
differ from that of ```M```.  We will define $E$ to be a random point
in $V^k$ in terms of a matrix:

```{r}
E <- matrix(rnorm(n*k),n,k)   # A random point in V^k
```

Then

```{r}
f <- as.function(S)
f(E)
```

Testing  multilinearity is straightforward in the package:
```{r}

E1 <- E
E2 <- E
E3 <- E

x1 <- rnorm(n)
x2 <- rnorm(n)
r1 <- rnorm(1)
r2 <- rnorm(1)

E1[,2] <- x1
E2[,2] <- x2
E3[,2] <- r1*x1 + r2*x2
```

Then we can verify the multilinearity of $S$:

```{r}

f <- as.function(S)
c(r1*f(E1) + r2*f(E2), f(E3)) # should match
```


Note that this is *not* equivalent to linearity over $V^{nk}$:


```{r}
E1 <- matrix(rnorm(n*k),n,k)
E2 <- matrix(rnorm(n*k),n,k)
c(f(E1+E2),f(E1)+f(E2))
```

Given two k-tensor objects \eqn{S,T} we can form the cross product
$S\otimes T$, defined as

\[
S\otimes T\left(v_1,\ldots,v_k,v_{k+1},\ldots, v_{k+l}\right)=
  S\left(v_1,\ldots v_k\right)\cdot T\left(v_{k+1},\ldots
  v_{k+l}\right)
\]


```{r}
S1 <- ktensor(spray(cbind(1:3,2:4)))
S2 <- as.ktensor(matrix(1:6,2,3),1:2)
S1
S2
```

The R idiom for $S1\otimes S2$ would be ```cross()```, or ```%X%```:


```{r}
cross(S1,S2)
```

Then, for example:

```{r}
as.function(cross(S1,S2))(matrix(rnorm(30),6,5))
```

# Alternating forms

An alternating form is a multiliar map $T$ satisfying

\[
\mathrm{T}\left(v_1,\ldots,v_i,\ldots,v_j,\ldots,v_k\right)=
    -\mathrm{T}\left(v_1,\ldots,v_j,\ldots,v_i,\ldots,v_k\right)
\]

We write $\Lambda^k(V)$ for the space of all alternating multilinear
maps from $V^k$ to $\mathbb{R}$.  Spivak gives
$\operatorname{Alt}\colon\mathcal{J}^k(V)\longrightarrow\Lambda^k(V)$
defined by

\[\mathrm{Alt}(T)\left(v_1,\ldots,v_k\right)=
    \frac{1}{k!}\sum_{\sigma\in S_k}\mathrm{sgn}(\sigma)\cdot
    T\left(v_{\sigma(1)},\ldots,v_{\sigma(k)}\right)
\]

```{r}
S1
Alt(S1)
```

And verifying that it is in fact alternating is straightforward:

```{r}
E <- matrix(rnorm(8),4,2)
Erev <- E[,2:1]
as.function(Alt(S1))(E) + as.function(Alt(S1))(Erev)  # should be zero
```

However, we can see that this form for alternating tensors (here
called $k$-forms) is inefficient and highly redundant.  The package
provides ```kform``` objects which are inherently alternating.

The exterior calculus deals with objects such as $dx_1\wedge dx_2$,
which is an alternating linear map from
$\mathbb{R}^n\times\mathbb{R}^n$ to $\mathbb{R}$ with

\[
\left(
dx_1\wedge dx_2
\right)\left(
\begin{pmatrix}a_1\\a_2\\ \vdots\\ a_n\end{pmatrix},
\begin{pmatrix}b_1\\b_2\\ \vdots\\ b_n\end{pmatrix}
\right)=\mathrm{det}
\begin{pmatrix} a_1 & b_1 \\ a_2 & b_2\end{pmatrix}
=a_1b_2-a_2b_1
\]

Because such objects are linear, it is possible to consider more
complicated forms such as $dx_1\wedge dx_2 + 3 dx_2\wedge dx_3$ with

\[
\left(
dx_1\wedge dx_2 + 3dx_2\wedge dx_3
\right)\left(
\begin{pmatrix}a_1\\a_2\\ \vdots\\ a_n\end{pmatrix},
\begin{pmatrix}b_1\\b_2\\ \vdots\\ b_n\end{pmatrix}
\right)=\mathrm{det}
\begin{pmatrix} a_1 & b_1\\ a_2 & b_2\end{pmatrix}
+3\mathrm{det}
\begin{pmatrix} a_2 & b_2\\ a_3 & b_3\end{pmatrix}
\]

or even $dx_1\wedge dx_2\wedge dx_3 +5dx_1\wedge dx_2\wedge dx_4$
which would be a linear map from $\left(\mathbb{R}^n\right)^3$ to
$\mathbb{R}$ with


\[
\left(
dx_1\wedge dx_2\wedge dx_3 +5dx_1\wedge dx_2\wedge dx_4
\right)\left(
\begin{pmatrix}a_1\\a_2\\ \vdots\\ a_n\end{pmatrix},
\begin{pmatrix}b_1\\b_2\\ \vdots\\ b_n\end{pmatrix},
\begin{pmatrix}c_1\\c_2\\ \vdots\\ c_n\end{pmatrix}
\right)=\mathrm{det}
\begin{pmatrix}
	a_1 & b_1 & c_1\\
	a_2 & b_2 & c_2\\
	a_3 & b_3 & c_3
\end{pmatrix}
+5\mathrm{det}
\begin{pmatrix}
	a_1 & b_1 & c_1\\
	a_2 & b_2 & c_2\\
	a_4 & b_4 & c_4
\end{pmatrix}.
\]

Taking the last form as an example, this has ready R idiom:

```{r}
K <- as.kform(matrix(c(1,1,2,2,3,4),2,3),c(1,5))
K
```

Note that the order of the terms has been reversed, as the wedge
package uses the efficient spray package.  Observe that this does not
affect the value of the form as addition is commutative.




Consider the following idiom:


```{r}
kform_general(4,2,1:6)
```