---
title: "`wedge()` and related functions in the `stokes` package"
author: "Robin K. S. Hankin"
output: html_document
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{wedge}
  %\usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("stokes")
library("emulator")
set.seed(0)
```

```{r}
wedge
wedge2
```

Function `wedge()` returns the wedge product of any number of kforms,
function `wedge2()` returns the wedge product of two kforms.  Spivak
gives us:

\[
\omega\wedge\eta=\frac{\left(k+l\right)!}{k!l!}\operatorname{Alt}(\omega\otimes\eta),\qquad\omega\in\Lambda^k(V),\eta\in\Lambda^l(V)
\]

Function `wedge2()` implements this, although the idiom is somewhat
opaque, especially the combinatorial coefficient.


## Digression: function `spraycross()`

Function `spraycross()` is part of the `spray` package and gives a
cross product of sparse arrays:

```{r}
(a <- spray(matrix(1:4,2,2),c(2,5)))
(b <- spray(matrix(c(10,11,12,13),2,2),c(7,11)))
spraycross(a,b)
spraycross(b,a)
```

Observe that `spraycross()` (and by association `wedge()`)is
associative and distributive but not commutative.

### Cut to the chase: `wedge2()`

Function `wedge2()` takes two kforms and we will start with a very
simple example:

```{r}
(x <- as.kform(cbind(1,2),5))
(y <- as.kform(cbind(3,4,7),7))
wedge2(x,y)
```

It looks like the combinatorial term has not been included but it has.
We will express `x` and `y` as tensors (objects of class `ktensor`)
and show how the combinatorial term arises.

```{r}
 tx <- as.ktensor(x)    # "tx" = tensor 'x'
(ty <- as.ktensor(y))   # "ty" = tensor 'y'
```

As functions, `y` and `ty` are identical:

```{r}
M <- matrix(round(rnorm(21),2),7,3) # member of (R^7)^3
as.function(y)(M)
as.function(ty)(M)
```

Both are equivalent to

```{r}
7*(
 +M[3,1]*M[4,2]*M[7,3] 
 -M[3,1]*M[4,3]*M[7,2] 
 -M[3,2]*M[4,1]*M[7,3] 
 +M[3,2]*M[4,3]*M[7,1] 
 +M[3,3]*M[4,1]*M[7,2]
 -M[3,3]*M[4,2]*M[7,1]
 )
```

We can see that `y` is a more compact and efficient representation of
`ty`: both are alternating tensors but `y` has alternatingness built in
to its evaluation, while `ty` is alternating by virtue of including
all permutations of its arguments, with the sign of the permutation.


We can evaluate Spivak's formula (but without the combinatorical term)
for $x\wedge y$ by coercing to ktensors and using `cross()`:

```{r}
(z <- cross(as.ktensor(x),as.ktensor(y)))
```

Above, each coefficient is equal to $\pm 35$ (the sign coming from the
sign of the permutation), and we have $2!3!=12$ rows.  We can now
calculate $\operatorname{Alt}(z)$, which would have $5!=120$ rows, one
per permutation of $[5]$, each with coefficient $\pm\frac{12\times
35}{5!}=\pm 3.5$.

We define $x\wedge y$ to be $\frac{5!}{3!2!}\operatorname{Alt}(z)$, so
each coefficient would be $\pm\frac{5!}{3!2!}\cdot\frac{12\times
35}{5!}=35$.  We know that $x\wedge y$ is an alternating form.  So to
represent it as an object of class `kform`, we need a `kform` object
with _single_ index entry `1 2 3 4 7`.  This would need coefficient
35, on the grounds that it is linear, alternating, and maps
$\begin{pmatrix}
1&0&0&0&0\\
0&1&0&0&0\\
0&0&1&0&0\\
0&0&0&1&0\\
0&0&0&0&0\\
0&0&0&0&0\\
0&0&0&0&1
\end{pmatrix}$ to $35$; and indeed this is what we see:

```{r}
wedge(x,y)
```

So to conclude, the combinatorial term is present in the R idiom, it
is just difficult to see at first glance.

